var MapVM = function() {	var self = this;	this.map; //Note: the map is not an observable. Why?	this.infoWindow;	this.setMap = function(aMap) {		self.map = aMap;	};	this.buildMarker = function(info) {		var fishSymbol = {						path: "M 0 5 C 5 0 5 0 20 10 C 17 5 17 5 20 0 C 5 10 5 10 0 5 z",						fillColor: 'green',						fillOpacity: 0.5						};		if (0 < info.latlon().length) {			var nums = info.latlon().split(",");			var ll = new google.maps.LatLng(nums[0], nums[1]);			var marker = new google.maps.Marker({				map: null,				position: ll,				title: info.name(),				icon: fishSymbol			});			info.marker(marker);			google.maps.event.addListener(marker, 'click', function() {				viewModel.setCurrentLake(info);			});		};	};	this.loadMapApi = function() {//console.log("loadMapApi");		var script = document.createElement('script');		script.type = 'text/javascript';		script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyC5nj4Q9nLWhbewfJYIjARH-HheRPHCKgE' +			'&callback=showMap'; //&signed_in=true		document.body.appendChild(script);	};	this.removeMapMarkers = function() {		viewModel.lakes().forEach(function(aLake) {			if (aLake.marker()) {				aLake.marker().setMap(null);			}		});	};	this.addMapMarkers = function() {		var bounds = new google.maps.LatLngBounds();		bounds.extend(self.map.getCenter());		viewModel.getFilteredLakes().forEach(function(info) {			if (typeof info.marker() !== "undefined") {				info.marker().setMap(self.map);				bounds.extend(info.marker().getPosition());			};		});		self.map.fitBounds(bounds);	};	this.wireUpMapMarkers = function() {		//This next line is quite a special case. It has to refer to		//the ko.computed itself, and not the array that is typically		//returned from it. Decoupling this VM from that one would be		//significantly more trouble than it's worth.		lakeListVM.filteredLakes.subscribe(function(newList) {			self.removeMapMarkers();			self.addMapMarkers();		});	};	this.displayInfo = function() {//console.log("displayInfo");		self.infoWindow.setContent($('#lakeDetails').html());		var currentLake = viewModel.getCurrentLake();		self.infoWindow.open(self.map, currentLake.marker());		viewModel.setLocation(currentLake.lat(), currentLake.lon());	};}function showMap() {console.log("showMap");	//move the code in here to a more appropriate place	// (like into the mapVM and the viewModel)	var mapOptions = {		center: { lat: 42.105287, lng: -87.939661},		zoom: 8	};	var mapView = $('#mapView')[0];	mapVM.setMap(new google.maps.Map(mapView, mapOptions));	mapVM.infoWindow = new google.maps.InfoWindow({		content: $('#lakeDetails').html()	});		viewModel.init();};